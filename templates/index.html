<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CalypsoPy+ by Serial Cables - Professional Hardware Interface</title>

    <!-- External Dependencies -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.min.js"></script>

    <!-- CalypsoPy+ Styles -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üîå</text></svg>">
</head>
<body>
    <!-- Header Bar -->
    <div class="header-bar">
        <div class="brand-logo">
            <div class="brand-icon">CP</div>
            <div class="brand-text">
                <h1>CalypsoPy+</h1>
                <div class="tagline">by Serial Cables</div>
            </div>
        </div>

        <div class="header-controls">
            <div class="developer-mode-toggle">
                <label style="display: flex; align-items: center; gap: 8px; color: rgba(255, 255, 255, 0.8); font-size: 13px; font-weight: 500; cursor: pointer;">
                    <input type="checkbox" id="developerMode" style="transform: scale(1.2);">
                    <span>üîì Developer Mode</span>
                </label>
            </div>
            <div id="connectionStatus" class="connection-status disconnected">
                <div class="status-dot"></div>
                <span>Disconnected</span>
            </div>
        </div>
    </div>

    <div class="main-container">
        <!-- Sidebar Navigation -->
        <nav class="sidebar">
            <div class="nav-section">
                <h3>Connection</h3>
                <div class="nav-item active" data-dashboard="connection">
                    <div class="nav-icon">üîå</div>
                    <div class="nav-text">Device Connection</div>
                </div>
            </div>

            <div class="nav-section">
                <h3>Dashboards</h3>
                <div class="nav-item" data-dashboard="device_info">
                    <div class="nav-icon">üìã</div>
                    <div class="nav-text">Device Info</div>
                </div>
                <div class="nav-item" data-dashboard="link_status">
                    <div class="nav-icon">üì°</div>
                    <div class="nav-text">Link Status</div>
                </div>
                <div class="nav-item" data-dashboard="bifurcation">
                    <div class="nav-icon">üîÄ</div>
                    <div class="nav-text">Bifurcation</div>
                </div>
                <div class="nav-item" data-dashboard="i2c">
                    <div class="nav-icon">üîó</div>
                    <div class="nav-text">I2C/I3C</div>
                </div>
                <div class="nav-item" data-dashboard="advanced">
                    <div class="nav-icon">üî¨</div>
                    <div class="nav-text">Advanced</div>
                </div>
                <div class="nav-item" data-dashboard="resets">
                    <div class="nav-icon">üîÑ</div>
                    <div class="nav-text">Resets</div>
                </div>
                <div class="nav-item" data-dashboard="firmware">
                    <div class="nav-icon">‚¨ÜÔ∏è</div>
                    <div class="nav-text">Firmware Updates</div>
                </div>
            </div>

            <div class="nav-section">
                <h3>System</h3>
                <div class="nav-item" data-dashboard="analytics">
                    <div class="nav-icon">üìä</div>
                    <div class="nav-text">Analytics</div>
                    <div class="nav-badge" id="commandCount">0</div>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Connection Dashboard -->
            <div id="connection-dashboard" class="dashboard-content active">
                <div class="dashboard-header">
                    <h2 class="dashboard-title">Device Connection</h2>
                    <p class="dashboard-subtitle">Connect to your hardware device to begin diagnostics and control</p>
                </div>

                <div class="dashboard-grid">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon">üîå</div>
                                Serial Port Selection
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Available Ports</label>
                            <select id="portSelect" class="form-control">
                                <option value="">Scanning for devices...</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Connection Properties</label>
                            <div style="background: var(--light-gray); padding: 15px; border-radius: 10px; font-size: 14px; color: var(--secondary-gray);">
                                <strong>Baud Rate:</strong> 115,200 bps<br>
                                <strong>Data Bits:</strong> 8<br>
                                <strong>Parity:</strong> None<br>
                                <strong>Stop Bits:</strong> 1<br>
                                <strong>Flow Control:</strong> None<br>
                                <strong>Timeout:</strong> 2.0 seconds
                            </div>
                        </div>

                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <button id="connectBtn" class="btn btn-primary" disabled>
                                <span>üîó</span> Connect Device
                            </button>
                            <button id="disconnectBtn" class="btn btn-secondary" disabled>
                                <span>üîå</span> Disconnect
                            </button>
                            <button id="refreshBtn" class="btn btn-outline">
                                <span>üîÑ</span> Refresh Ports
                            </button>
                            <button id="testApiBtn" class="btn btn-outline" style="background-color: #28a745; color: white;">
                                <span>üß™</span> Test API
                            </button>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon">üìä</div>
                                Connection Status
                            </div>
                        </div>

                        <div id="connectionDetails">
                            <p style="color: var(--secondary-gray); font-style: italic;">No device connected</p>
                        </div>

                        <div style="margin-top: 20px; padding: 15px; background: var(--light-gray); border-radius: 10px;">
                            <h4 style="color: var(--primary-red); margin-bottom: 10px; font-size: 16px;">üöÄ Getting Started</h4>
                            <ol style="color: var(--secondary-gray); font-size: 14px; line-height: 1.6; margin-left: 20px;">
                                <li>Connect your hardware device via USB/Serial cable</li>
                                <li>Click "Refresh Ports" to scan for new devices</li>
                                <li>Select your device from the dropdown menu</li>
                                <li>Click "Connect Device" to establish connection</li>
                                <li>Once connected, you'll be taken to Device Information</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Device Info Dashboard -->
            <div id="device_info-dashboard" class="dashboard-content">
                <div class="dashboard-header">
                    <div style="display: flex; justify-content: space-between; align-items: flex-end;">
                        <div>
                            <h2 class="dashboard-title">Device Information</h2>
                            <p class="dashboard-subtitle">Hardware identification and system status information</p>
                        </div>
                        <div style="display: flex; gap: 15px;">
                            <button class="btn btn-outline" id="exportDeviceInfo">
                                <span>üìÑ</span> Export Report
                            </button>
                        </div>
                    </div>
                </div>

                <!-- System Overview Cards -->
                <div class="metrics-row">
                    <div class="metric-card">
                        <div class="metric-value" id="deviceModel">Unknown</div>
                        <div class="metric-label">Device Model</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="firmwareVersion">Unknown</div>
                        <div class="metric-label">Firmware Version</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="serialNumber">Unknown</div>
                        <div class="metric-label">Serial Number</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="boardTemp">--¬∞C</div>
                        <div class="metric-label">Board Temperature</div>
                    </div>
                </div>

                <div class="dashboard-grid">
                    <!-- Hardware Information -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon">üîß</div>
                                Hardware Information
                            </div>
                            <button class="btn btn-sm btn-outline" id="refreshDeviceInfo">
                                <span>üîÑ</span> Refresh
                            </button>
                        </div>

                        <div class="info-grid">
                            <div class="info-item">
                                <label class="info-label">S/N</label>
                                <span class="info-value" id="hwSerialNumber">--</span>
                            </div>
                            <div class="info-item">
                                <label class="info-label">Company</label>
                                <span class="info-value" id="hwCompany">--</span>
                            </div>
                            <div class="info-item">
                                <label class="info-label">Model</label>
                                <span class="info-value" id="hwModel">--</span>
                            </div>
                            <div class="info-item">
                                <label class="info-label">Version</label>
                                <span class="info-value" id="hwVersion">--</span>
                            </div>
                            <div class="info-item">
                                <label class="info-label">SDK Version</label>
                                <span class="info-value" id="sdkVersion">--</span>
                            </div>
                        </div>
                    </div>

                    <!-- Thermal Status -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon">üå°Ô∏è</div>
                                Thermal Status
                            </div>
                        </div>

                        <div class="thermal-display">
                            <div class="thermal-item">
                                <div class="thermal-label">Board Temperature</div>
                                <div class="thermal-value" id="thermalBoardTemp">--¬∞C</div>
                                <div class="thermal-status" id="thermalBoardStatus">Normal</div>
                            </div>
                            <div class="thermal-item">
                                <div class="thermal-label">Fan Speed</div>
                                <div class="thermal-value" id="fanSpeed">-- RPM</div>
                                <div class="thermal-bar">
                                    <div class="thermal-bar-fill" id="fanSpeedBar" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Voltage Sensors -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon">‚ö°</div>
                                Voltage Sensors
                            </div>
                        </div>

                        <div class="voltage-grid" id="voltageGrid">
                            <!-- Voltage items will be populated dynamically -->
                        </div>
                    </div>

                    <!-- Current Status -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon">üîã</div>
                                Current Status
                            </div>
                        </div>

                        <div class="current-display">
                            <div class="current-item">
                                <div class="current-label">Board Current</div>
                                <div class="current-value" id="boardCurrent">-- mA</div>
                            </div>
                        </div>
                    </div>

                    <!-- Port Configuration -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon">üîå</div>
                                Port Configuration
                            </div>
                        </div>

                        <div class="port-grid" id="portGrid">
                            <!-- Port items will be populated dynamically -->
                        </div>
                    </div>

                    <!-- Error Status -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon">‚ö†Ô∏è</div>
                                Error Status
                            </div>
                        </div>

                        <div class="error-grid" id="errorGrid">
                            <!-- Error items will be populated dynamically -->
                        </div>
                    </div>

                    <!-- Command Interface -->
                    <div class="card command-interface">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon">üí¨</div>
                                Device Commands
                            </div>
                            <div class="card-actions">
                                <label style="display: flex; align-items: center; gap: 8px; font-size: 13px; color: var(--secondary-gray);">
                                    <input type="checkbox" id="useCacheDevice" checked> Use cache
                                </label>
                            </div>
                        </div>

                        <div class="command-input-group">
                            <input type="text" id="deviceCommandInput" class="form-control" placeholder="Enter custom command..." disabled>
                            <button id="sendDeviceCmd" class="btn btn-primary" disabled>
                                <span>üì§</span> Send
                            </button>
                        </div>

                        <div class="command-presets" id="devicePresets">
                            <div class="preset-btn" data-cmd="sysinfo" data-desc="System information">
                                <div class="preset-title">System Info</div>
                                <div class="preset-command">sysinfo</div>
                            </div>
                            <div class="preset-btn" data-cmd="version" data-desc="Firmware version">
                                <div class="preset-title">Version Info</div>
                                <div class="preset-command">version</div>
                            </div>
                            <div class="preset-btn" data-cmd="temp" data-desc="Temperature readings">
                                <div class="preset-title">Temperature</div>
                                <div class="preset-command">temp</div>
                            </div>
                            <div class="preset-btn" data-cmd="voltage" data-desc="Voltage readings">
                                <div class="preset-title">Voltage</div>
                                <div class="preset-command">voltage</div>
                            </div>
                            <div class="preset-btn" data-cmd="current" data-desc="Current readings">
                                <div class="preset-title">Current</div>
                                <div class="preset-command">current</div>
                            </div>
                            <div class="preset-btn" data-cmd="status" data-desc="Overall status">
                                <div class="preset-title">Status</div>
                                <div class="preset-command">status</div>
                            </div>
                        </div>

                        <div class="console-container" id="deviceConsole">
                            <div class="console-entry command">
                                <div class="console-timestamp">System Ready</div>
                                <div class="console-content">CalypsoPy+ Device Info Dashboard initialized. Connect to a device to view system information.</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Link Status Dashboard -->
            <div id="link_status-dashboard" class="dashboard-content">
                <div class="dashboard-header">
                    <div style="display: flex; justify-content: space-between; align-items: flex-end;">
                        <div>
                            <h2 class="dashboard-title">Link Status</h2>
                            <p class="dashboard-subtitle">Monitor PCIe port connections and lane configurations</p>
                        </div>
                        <div style="display: flex; gap: 15px;">
                            <button class="btn btn-outline" id="refreshLinkStatus">
                                <span>üîÑ</span> Refresh Status
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Metrics Overview -->
                <div class="metrics-row">
                    <div class="metric-card">
                        <div class="metric-value" id="totalPorts">--</div>
                        <div class="metric-label">Total Ports</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="activePorts">--</div>
                        <div class="metric-label">Active Connections</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="goldenFingerStatus">--</div>
                        <div class="metric-label">Golden Finger</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="maxSpeed">--</div>
                        <div class="metric-label">Maximum Speed</div>
                    </div>
                </div>

                <div class="dashboard-grid">
                    <!-- Port Status Grid -->
                    <div class="card" style="grid-column: span 2;">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon">üì°</div>
                                PCIe Port Status
                            </div>
                        </div>

                        <div class="port-status-grid" id="portStatusGrid">
                            <div class="port-status-loading">
                                <div class="loading"></div>
                                <p>Connect to a device and run 'showport' to view port status</p>
                            </div>
                        </div>
                    </div>

                    <!-- Command Interface -->
                    <div class="card command-interface" style="grid-column: span 2;">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon">üí¨</div>
                                Link Status Commands
                            </div>
                            <div class="card-actions">
                                <label style="display: flex; align-items: center; gap: 8px; font-size: 13px; color: var(--secondary-gray);">
                                    <input type="checkbox" id="useCacheLinkStatus" checked> Use cache
                                </label>
                            </div>
                        </div>

                        <div class="command-input-group">
                            <input type="text" id="linkCommandInput" class="form-control" placeholder="Enter link status command..." disabled>
                            <button id="sendLinkCmd" class="btn btn-primary" disabled>
                                <span>üì§</span> Send
                            </button>
                        </div>

                        <div class="command-presets" id="linkPresets">
                            <div class="preset-btn" data-cmd="showport" data-desc="Display port status and lane configurations">
                                <div class="preset-title">Show Ports</div>
                                <div class="preset-command">showport</div>
                            </div>
                            <div class="preset-btn" data-cmd="linkinfo" data-desc="Link information details">
                                <div class="preset-title">Link Info</div>
                                <div class="preset-command">linkinfo</div>
                            </div>
                            <div class="preset-btn" data-cmd="portstatus" data-desc="Detailed port status">
                                <div class="preset-title">Port Status</div>
                                <div class="preset-command">portstatus</div>
                            </div>
                            <div class="preset-btn" data-cmd="bandwidth" data-desc="Bandwidth utilization">
                                <div class="preset-title">Bandwidth</div>
                                <div class="preset-command">bandwidth</div>
                            </div>
                        </div>

                        <div class="console-container" id="linkConsole">
                            <div class="console-entry command">
                                <div class="console-timestamp">System Ready</div>
                                <div class="console-content">Link Status monitoring ready. Execute 'showport' to view PCIe port connections.</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bifurcation Dashboard -->
            <div id="bifurcation-dashboard" class="dashboard-content">
                <div class="dashboard-header">
                    <div style="display: flex; justify-content: space-between; align-items: flex-end;">
                        <div>
                            <h2 class="dashboard-title">PCIe Bifurcation Configuration</h2>
                            <p class="dashboard-subtitle">Monitor and configure PCIe lane bifurcation modes</p>
                        </div>
                        <div style="display: flex; gap: 15px;">
                            <button class="btn btn-outline" id="refreshBifurcation">
                                <span>üîÑ</span> Refresh Mode
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Current Mode Overview -->
                <div class="metrics-row">
                    <div class="metric-card">
                        <div class="metric-value" id="currentSBRMode">--</div>
                        <div class="metric-label">Current SBR Mode</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="goldenFingerConfig">--</div>
                        <div class="metric-label">Golden Finger</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="straddlePCIE">--</div>
                        <div class="metric-label">Straddle PCIE</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="mcioStatus">--</div>
                        <div class="metric-label">MCIO Status</div>
                    </div>
                </div>

                <div class="dashboard-grid">
                    <!-- Current Configuration Card -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon">üîÄ</div>
                                Current Bifurcation Mode
                            </div>
                        </div>

                        <div id="bifurcationModeDisplay" class="bifurcation-mode-display">
                            <div class="bifurcation-mode-card">
                                <div class="bifurcation-mode-header">
                                    <span class="bifurcation-mode-number">Mode: --</span>
                                    <span class="bifurcation-status-badge active">ACTIVE</span>
                                </div>
                                <div class="bifurcation-mode-details">
                                    <div class="bifurcation-detail-row">
                                        <span class="detail-label">Golden Finger:</span>
                                        <span class="detail-value" id="modeGoldenFinger">--</span>
                                    </div>
                                    <div class="bifurcation-detail-row">
                                        <span class="detail-label">Straddle PCIE:</span>
                                        <span class="detail-value" id="modeStraddlePCIE">--</span>
                                    </div>
                                    <div class="bifurcation-detail-row">
                                        <span class="detail-label">Left MCIO:</span>
                                        <span class="detail-value" id="modeLeftMCIO">--</span>
                                    </div>
                                    <div class="bifurcation-detail-row">
                                        <span class="detail-label">Right MCIO:</span>
                                        <span class="detail-value" id="modeRightMCIO">--</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Available Modes Table -->
                    <div class="card bifurcation-modes-table">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon">üìã</div>
                                Available Bifurcation Modes
                            </div>
                        </div>

                        <div class="bifurcation-table-container">
                            <table class="bifurcation-table">
                                <thead>
                                    <tr>
                                        <th>SBR Mode</th>
                                        <th>Golden Finger</th>
                                        <th>Straddle PCIE</th>
                                        <th>Left MCIO</th>
                                        <th>Right MCIO</th>
                                    </tr>
                                </thead>
                                <tbody id="bifurcationTableBody">
                                    <tr data-mode="0">
                                        <td><span class="mode-indicator">0</span></td>
                                        <td><span class="lane-config">X16(SSC)</span></td>
                                        <td><span class="lane-config">X16(CC)</span></td>
                                        <td><span class="lane-config">X16(CC)</span></td>
                                        <td><span class="lane-config">X16(CC)</span></td>
                                    </tr>
                                    <tr data-mode="1">
                                        <td><span class="mode-indicator">1</span></td>
                                        <td><span class="lane-config">X16(SSC)</span></td>
                                        <td><span class="lane-config">X16(CC)</span></td>
                                        <td><span class="lane-config">X8(CC)</span></td>
                                        <td><span class="lane-config">X8(CC)</span></td>
                                    </tr>
                                    <tr data-mode="2">
                                        <td><span class="mode-indicator">2</span></td>
                                        <td><span class="lane-config">X16(SSC)</span></td>
                                        <td><span class="lane-config">X16(CC)</span></td>
                                        <td><span class="lane-config">X4(CC)</span></td>
                                        <td><span class="lane-config">X4(CC)</span></td>
                                    </tr>
                                    <tr data-mode="3">
                                        <td><span class="mode-indicator">3</span></td>
                                        <td><span class="lane-config">X16(SSC)</span></td>
                                        <td><span class="lane-config">X16(CC)</span></td>
                                        <td><span class="lane-config">X2(CC)</span></td>
                                        <td><span class="lane-config">X2(CC)</span></td>
                                    </tr>
                                    <tr data-mode="4">
                                        <td><span class="mode-indicator">4</span></td>
                                        <td><span class="lane-config">X16(SSC)</span></td>
                                        <td><span class="lane-config">X16(CC)</span></td>
                                        <td><span class="lane-config">X8(CC)</span></td>
                                        <td><span class="lane-config">X16(CC)</span></td>
                                    </tr>
                                    <tr data-mode="5">
                                        <td><span class="mode-indicator">5</span></td>
                                        <td><span class="lane-config">X16(SSC)</span></td>
                                        <td><span class="lane-config">X16(CC)</span></td>
                                        <td><span class="lane-config">X4(CC)</span></td>
                                        <td><span class="lane-config">X16(CC)</span></td>
                                    </tr>
                                    <tr data-mode="6">
                                        <td><span class="mode-indicator">6</span></td>
                                        <td><span class="lane-config">X16(SSC)</span></td>
                                        <td><span class="lane-config">X16(CC)</span></td>
                                        <td><span class="lane-config">X16(CC)</span></td>
                                        <td><span class="lane-config">X4(CC)</span></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- I2C Dashboard -->
            <div id="i2c-dashboard" class="dashboard-content">
                <div class="dashboard-header">
                    <h2 class="dashboard-title">I2C/I3C Interface</h2>
                    <p class="dashboard-subtitle">Configure and monitor I2C/I3C communication interfaces</p>
                </div>

                <div class="dashboard-grid">
                    <div class="card command-interface">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon">üîó</div>
                                I2C/I3C Commands
                            </div>
                        </div>

                        <div class="command-input-group">
                            <input type="text" id="i2cCommandInput" class="form-control" placeholder="Enter I2C/I3C command..." disabled>
                            <button id="sendI2cCmd" class="btn btn-primary" disabled>
                                <span>üì§</span> Send
                            </button>
                        </div>

                        <div class="command-presets" id="i2cPresets">
                            <div class="preset-btn" data-cmd="I2C_SCAN" data-desc="Scan I2C bus">
                                <div class="preset-title">I2C Scan</div>
                                <div class="preset-command">I2C_SCAN</div>
                            </div>
                            <div class="preset-btn" data-cmd="I3C_STATUS" data-desc="I3C status">
                                <div class="preset-title">I3C Status</div>
                                <div class="preset-command">I3C_STATUS</div>
                            </div>
                        </div>

                        <div class="console-container" id="i2cConsole">
                            <div class="console-entry command">
                                <div class="console-timestamp">System Ready</div>
                                <div class="console-content">I2C/I3C interface ready for commands.</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Advanced Dashboard -->
            <div id="advanced-dashboard" class="dashboard-content">
                <div class="dashboard-header">
                    <h2 class="dashboard-title">Advanced Diagnostics</h2>
                    <p class="dashboard-subtitle">Advanced hardware diagnostics and testing tools</p>
                </div>

                <div class="dashboard-grid">
                    <div class="card command-interface">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon">üî¨</div>
                                Advanced Commands
                            </div>
                        </div>

                        <div class="command-input-group">
                            <input type="text" id="advancedCommandInput" class="form-control" placeholder="Enter advanced command..." disabled>
                            <button id="sendAdvancedCmd" class="btn btn-primary" disabled>
                                <span>üì§</span> Send
                            </button>
                        </div>

                        <div class="command-presets" id="advancedPresets">
                            <div class="preset-btn" data-cmd="DIAG_FULL" data-desc="Full diagnostics">
                                <div class="preset-title">Full Diagnostics</div>
                                <div class="preset-command">DIAG_FULL</div>
                            </div>
                            <div class="preset-btn" data-cmd="MEM_TEST" data-desc="Memory test">
                                <div class="preset-title">Memory Test</div>
                                <div class="preset-command">MEM_TEST</div>
                            </div>
                        </div>

                        <div class="console-container" id="advancedConsole">
                            <div class="console-entry command">
                                <div class="console-timestamp">System Ready</div>
                                <div class="console-content">Advanced diagnostics ready.</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Resets Dashboard -->
            <!-- Resets Dashboard - Replace the existing resets dashboard section -->
            <div id="resets-dashboard" class="dashboard-content">
                <div class="dashboard-header">
                    <div>
                        <h2 class="dashboard-title">System Resets</h2>
                        <p class="dashboard-subtitle">Hardware reset controls and recovery operations</p>
                    </div>
                </div>

                <!-- Warning Banner -->
                <div class="reset-warning-banner">
                    <div class="warning-icon">‚ö†Ô∏è</div>
                    <div class="warning-content">
                        <div class="warning-title">Caution: System Reset Operations</div>
                        <div class="warning-text">
                            Reset operations will interrupt device operation and may cause temporary disconnection.
                            Please ensure no critical operations are in progress before proceeding.
                        </div>
                    </div>
                </div>

                <!-- Reset Control Grid -->
                <div class="reset-control-grid">
                    <!-- PCIe Straddle Mount Reset -->
                    <div class="reset-control-card">
                        <div class="reset-card-header">
                            <div class="reset-icon pcie">üîå</div>
                            <div class="reset-card-title">
                                <h3>PCIe Straddle Mount Reset</h3>
                                <p>Reset the PCIe Straddle Mount Connector</p>
                            </div>
                        </div>
                        <div class="reset-card-body">
                            <ul class="reset-description">
                                <li>Resets the PCIe straddle mount connector</li>
                                <li>Reinitializes the connection interface</li>
                                <li>Does not affect other system components</li>
                            </ul>
                            <div class="reset-command-display">
                                <span class="command-label">Command:</span>
                                <code>mrst</code>
                            </div>
                        </div>
                        <div class="reset-card-footer">
                            <button class="btn btn-reset btn-pcie" data-reset-cmd="mrst" data-reset-type="PCIe Straddle Mount">
                                <span class="btn-icon">üîÑ</span>
                                <span class="btn-text">Execute PCIe Reset</span>
                            </button>
                        </div>
                    </div>

                    <!-- Atlas 3 Switch Reset -->
                    <div class="reset-control-card">
                        <div class="reset-card-header">
                            <div class="reset-icon switch">üîÄ</div>
                            <div class="reset-card-title">
                                <h3>Atlas 3 Switch Reset</h3>
                                <p>Reset the Atlas 3 PCIe Switch</p>
                            </div>
                        </div>
                        <div class="reset-card-body">
                            <ul class="reset-description">
                                <li>Performs a software reset of the Atlas 3 switch</li>
                                <li>Clears switch state and error conditions</li>
                                <li>Reinitializes PCIe routing configuration</li>
                            </ul>
                            <div class="reset-command-display">
                                <span class="command-label">Command:</span>
                                <code>swreset</code>
                            </div>
                        </div>
                        <div class="reset-card-footer">
                            <button class="btn btn-reset btn-switch" data-reset-cmd="swreset" data-reset-type="Atlas 3 Switch">
                                <span class="btn-icon">üîÑ</span>
                                <span class="btn-text">Execute Switch Reset</span>
                            </button>
                        </div>
                    </div>

                    <!-- Full System Reset -->
                    <div class="reset-control-card critical">
                        <div class="reset-card-header">
                            <div class="reset-icon system">‚ö°</div>
                            <div class="reset-card-title">
                                <h3>Full System Reset</h3>
                                <p>Complete hardware system reset</p>
                            </div>
                        </div>
                        <div class="reset-card-body">
                            <ul class="reset-description">
                                <li>Performs a complete hardware system reset</li>
                                <li>Resets all components and subsystems</li>
                                <li>Requires CalypsoPy+ reconnection</li>
                            </ul>
                            <div class="reset-command-display critical">
                                <span class="command-label">Command:</span>
                                <code>reset</code>
                            </div>
                        </div>
                        <div class="reset-card-footer">
                            <button class="btn btn-reset btn-critical" data-reset-cmd="reset" data-reset-type="Full System">
                                <span class="btn-icon">‚ö°</span>
                                <span class="btn-text">Execute System Reset</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Reset History Log -->
                <div class="card reset-history-card">
                    <div class="card-header">
                        <div class="card-title">
                            <div class="card-icon">üìã</div>
                            Reset History
                        </div>
                        <button class="btn btn-sm btn-outline" id="clearResetHistory">
                            <span>üóëÔ∏è</span> Clear History
                        </button>
                    </div>
                    <div class="reset-history-container" id="resetHistoryContainer">
                        <div class="reset-history-entry system">
                            <div class="reset-history-timestamp">System Ready</div>
                            <div class="reset-history-content">Reset controls initialized. Ready to execute reset operations.</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Confirmation Modal -->
            <div id="resetConfirmationModal" class="modal-overlay">
                <div class="modal-container">
                    <div class="modal-header">
                        <div class="modal-icon">‚ö†Ô∏è</div>
                        <h3 class="modal-title">Confirm Reset Operation</h3>
                    </div>
                    <div class="modal-body">
                        <p class="modal-message" id="resetConfirmMessage">
                            Are you sure you want to execute this reset operation?
                        </p>
                        <div class="modal-warning">
                            <strong>Warning:</strong> This action cannot be undone and may temporarily interrupt device operation.
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" id="cancelResetBtn">
                            <span>‚úï</span> Cancel
                        </button>
                        <button class="btn btn-primary" id="confirmResetBtn">
                            <span>‚úì</span> Confirm Reset
                        </button>
                    </div>
                </div>
            </div>

            <!-- Restart Required Modal -->
            <div id="restartRequiredModal" class="modal-overlay">
                <div class="modal-container">
                    <div class="modal-header">
                        <div class="modal-icon restart">üîÑ</div>
                        <h3 class="modal-title">Restart Required</h3>
                    </div>
                    <div class="modal-body">
                        <p class="modal-message">
                            The reset operation has been completed successfully. CalypsoPy+ needs to restart to re-establish the connection with your device.
                        </p>
                        <div class="modal-info">
                            <strong>Note:</strong> You will need to reconnect to your device after the restart.
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" id="restartLaterBtn">
                            <span>‚è∏Ô∏è</span> Restart Later
                        </button>
                        <button class="btn btn-primary" id="restartNowBtn">
                            <span>üîÑ</span> Restart Now
                        </button>
                    </div>
                </div>
            </div>

            <!-- Firmware Dashboard -->
            <div id="firmware-dashboard" class="dashboard-content">
                <div class="dashboard-header">
                    <div style="display: flex; justify-content: space-between; align-items: flex-end;">
                        <div>
                            <h2 class="dashboard-title">Firmware Updates</h2>
                            <p class="dashboard-subtitle">Update device firmware via XMODEM protocol</p>
                        </div>
                        <div style="display: flex; gap: 15px;">
                            <button class="btn btn-outline" id="checkFirmwareVersion">
                                <span>üìã</span> Check Version
                            </button>
                            <button class="btn btn-outline" id="clearFirmwareLog">
                                <span>üóëÔ∏è</span> Clear Log
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Firmware Status Cards -->
                <div class="metrics-row">
                    <div class="metric-card">
                        <div class="metric-value" id="currentFwVersion">--</div>
                        <div class="metric-label">Current Version</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="mcuStatus">--</div>
                        <div class="metric-label">MCU Status</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="sbr0Status">--</div>
                        <div class="metric-label">SBR0 Status</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="sbr1Status">--</div>
                        <div class="metric-label">SBR1 Status</div>
                    </div>
                </div>

                <div class="dashboard-grid">
                    <!-- MCU Firmware Update Card -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon">üíæ</div>
                                mCPU Firmware Update
                            </div>
                            <div class="mcu-update-status" id="mcuUpdateStatus">
                                <span class="status-indicator" id="mcuStatusIndicator">Ready</span>
                            </div>
                        </div>

                        <div class="firmware-update-section">
                            <div class="firmware-info-box">
                                <div class="info-row">
                                    <span class="info-label">Target:</span>
                                    <span class="info-value">mCPU (MCU)</span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Command:</span>
                                    <span class="info-value mono">fdl mcu</span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Protocol:</span>
                                    <span class="info-value">XMODEM-1K</span>
                                </div>
                            </div>

                            <div class="file-upload-zone" id="mcuDropZone">
                                <input type="file" id="mcuFileInput" accept=".bin,.hex,.fw" style="display: none;">
                                <div class="upload-icon">üìÅ</div>
                                <div class="upload-text">
                                    <strong>Drop MCU firmware file here</strong><br>
                                    <span class="upload-subtext">or click to browse</span>
                                </div>
                                <div class="supported-formats">Supported: .bin</div>
                            </div>

                            <div class="selected-file" id="mcuSelectedFile" style="display: none;">
                                <div class="file-icon">üìÑ</div>
                                <div class="file-details">
                                    <div class="file-name" id="mcuFileName">--</div>
                                    <div class="file-size" id="mcuFileSize">--</div>
                                </div>
                                <button class="btn btn-sm btn-outline" id="mcuRemoveFile">
                                    <span>‚úï</span>
                                </button>
                            </div>

                            <div class="update-controls">
                                <button class="btn btn-primary" id="startMcuUpdate" disabled>
                                    <span>‚¨ÜÔ∏è</span> Start MCU Update
                                </button>
                                <button class="btn btn-secondary" id="cancelMcuUpdate" style="display: none;">
                                    <span>‚úï</span> Cancel
                                </button>
                            </div>

                            <div class="progress-container" id="mcuProgress" style="display: none;">
                                <div class="progress-label">
                                    <span>Uploading MCU Firmware</span>
                                    <span id="mcuProgressPercent">0%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" id="mcuProgressBar" style="width: 0%"></div>
                                </div>
                                <div class="progress-stats">
                                    <span id="mcuBytesTransferred">0 B / 0 B</span>
                                    <span id="mcuTimeRemaining">--</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Switch (SBR) Firmware Update Card -->
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon">üîÄ</div>
                                Atlas3 Switch Update
                            </div>
                            <div class="sbr-update-status" id="sbrUpdateStatus">
                                <span class="status-indicator" id="sbrStatusIndicator">Ready</span>
                            </div>
                        </div>

                        <div class="firmware-update-section">
                            <div class="firmware-info-box">
                                <div class="info-row">
                                    <span class="info-label">Target:</span>
                                    <span class="info-value">Atlas 3 Switch</span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Commands:</span>
                                    <span class="info-value mono">fdl sbr0 + fdl sbr1</span>
                                </div>
                                <div class="info-row">
                                    <span class="info-label">Protocol:</span>
                                    <span class="info-value">XMODEM-1K (Dual Transfer)</span>
                                </div>
                            </div>

                            <div class="file-upload-zone" id="sbrDropZone">
                                <input type="file" id="sbrFileInput" accept=".bin,.hex,.fw" style="display: none;">
                                <div class="upload-icon">üìÅ</div>
                                <div class="upload-text">
                                    <strong>Drop SBR firmware file here</strong><br>
                                    <span class="upload-subtext">or click to browse</span>
                                </div>
                                <div class="supported-formats">Supported: .bin, .fw</div>
                            </div>

                            <div class="selected-file" id="sbrSelectedFile" style="display: none;">
                                <div class="file-icon">üìÑ</div>
                                <div class="file-details">
                                    <div class="file-name" id="sbrFileName">--</div>
                                    <div class="file-size" id="sbrFileSize">--</div>
                                </div>
                                <button class="btn btn-sm btn-outline" id="sbrRemoveFile">
                                    <span>‚úï</span>
                                </button>
                            </div>

                            <div class="update-controls">
                                <button class="btn btn-primary" id="startSbrUpdate" disabled>
                                    <span>‚¨ÜÔ∏è</span> Start SBR Update (Both Halves)
                                </button>
                                <button class="btn btn-secondary" id="cancelSbrUpdate" style="display: none;">
                                    <span>‚úï</span> Cancel
                                </button>
                            </div>

                            <div class="progress-container" id="sbrProgress" style="display: none;">
                                <div class="progress-label">
                                    <span id="sbrProgressLabel">Uploading SBR0 Firmware</span>
                                    <span id="sbrProgressPercent">0%</span>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" id="sbrProgressBar" style="width: 0%"></div>
                                </div>
                                <div class="progress-stats">
                                    <span id="sbrBytesTransferred">0 B / 0 B</span>
                                    <span id="sbrTimeRemaining">--</span>
                                </div>
                                <div class="sbr-dual-status">
                                    <div class="sbr-half-status">
                                        <span class="sbr-half-label">SBR0:</span>
                                        <span class="sbr-half-indicator" id="sbr0Indicator">Pending</span>
                                    </div>
                                    <div class="sbr-half-status">
                                        <span class="sbr-half-label">SBR1:</span>
                                        <span class="sbr-half-indicator" id="sbr1Indicator">Pending</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Firmware Update Log -->
                    <div class="card command-interface">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon">üìú</div>
                                Firmware Update Log
                            </div>
                            <div class="card-actions">
                                <label style="display: flex; align-items: center; gap: 8px; font-size: 13px; color: var(--secondary-gray);">
                                    <input type="checkbox" id="autoScrollLog" checked> Auto-scroll
                                </label>
                            </div>
                        </div>

                        <div class="console-container" id="firmwareConsole" style="height: 500px;">
                            <div class="console-entry system">
                                <div class="console-timestamp">System Ready</div>
                                <div class="console-content">Firmware update system initialized. Select a firmware file to begin update process.</div>
                            </div>
                        </div>

                        <div class="firmware-warnings">
                            <div class="warning-box">
                                <div class="warning-icon">‚ö†Ô∏è</div>
                                <div class="warning-content">
                                    <strong>Important:</strong> Do not disconnect the device or interrupt power during firmware updates.
                                    Ensure you have the correct firmware file for your device model.
                                    SBR updates will automatically update both halves sequentially.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Analytics Dashboard -->
            <div id="analytics-dashboard" class="dashboard-content">
                <div class="dashboard-header">
                    <h2 class="dashboard-title">System Analytics</h2>
                    <p class="dashboard-subtitle">Command history, performance metrics, and system analytics</p>
                </div>

                <div class="metrics-row">
                    <div class="metric-card">
                        <div class="metric-value" id="totalCommands">0</div>
                        <div class="metric-label">Total Commands</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="successfulCommands">0</div>
                        <div class="metric-label">Successful</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="errorCommands">0</div>
                        <div class="metric-label">Errors</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="avgResponseTime">0ms</div>
                        <div class="metric-label">Avg Response</div>
                    </div>
                </div>

                <div class="dashboard-grid">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon">üìä</div>
                                Command Performance
                            </div>
                            <button class="btn btn-sm btn-outline" id="clearAnalytics">
                                <span>üóëÔ∏è</span> Clear History
                            </button>
                        </div>

                        <canvas id="performanceChart" width="400" height="200"></canvas>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">
                                <div class="card-icon">üìã</div>
                                Command History
                            </div>
                        </div>

                        <div class="command-history" id="commandHistory">
                            <div class="history-entry">
                                <div class="history-timestamp">System Start</div>
                                <div class="history-command">Analytics tracking initialized</div>
                                <div class="history-status success">System</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- CalypsoPy+ Scripts -->
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    <script src="{{ url_for('static', filename='js/resets.js') }}"></script>
    <script src="{{ url_for('static', filename='js/dashboards.js') }}"></script>
    <script src="{{ url_for('static', filename='js/analytics.js') }}"></script>
    <!-- Firmware Updater Module -->
    <script src="{{ url_for('static', filename='js/FWUpdater.js') }}"></script>

</body>
</html>